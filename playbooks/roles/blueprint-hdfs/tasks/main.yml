--- 
- name: set HDFS blueprint path
  set_fact:
    blueprint_conf: "{{ role_path }}/templates/hdfs-blueprint.j2"
    
# Extra variables not generated by Jumbo
# Lighten the blueprint for more readability
#
# - name: set variable used in hdfs-blueprint.j2
#   set_fact:
#     metrics:
#       foo: "bar"
- name: Build variables for template
  set_fact:
    HDFS:
      namenodes_FQDN: "{{ serv_comp_host['HDFS']['NAMENODE'] | map('regex_replace', '^(.*)$', '\\1.' + domain) | list }}"
      snamenode_FQDN: "{{ serv_comp_host['HDFS']['SECONDARY_NAMENODE'][0]+'.'+domain if 'SECONDARY_NAMENODE' in serv_comp_host['HDFS'] else omit }}"
      nameservice: "{{ 'nn'+domain|regex_replace('\\.') if serv_comp_host['HDFS']['NAMENODE']|length > 1 else omit }}"
      journalnodes_FQDN: "{{ (serv_comp_host['HDFS']['JOURNALNODE'] | map('regex_replace', '^(.*)$', '\\1.' + domain) | list) if serv_comp_host['HDFS']['NAMENODE']|length > 1 else omit }}"


- name: Registering service HDFS
  debug:
    msg: "Added {{ blueprint_conf }}"
  changed_when: true
  notify: "add service to blueprint"

- meta: flush_handlers

